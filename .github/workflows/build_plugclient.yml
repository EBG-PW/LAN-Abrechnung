name: Build PlugClient

on:
  push:
    branches: [master]
    paths: [PlugsClientTasmota/**]
  workflow_dispatch:
  
jobs:
  ubuntu:
    name: Build PlugClient
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
    - uses: actions/checkout@v2
    - uses: actions/setup-node@v1
      with:
        node-version: 16.x
        cache: npm
    - name: Build
      run: |
        cd ./PlugsClientTasmota
        npm install
        npm install -g pkg
        pkg -t node16-win,node16-linux,node16-linux-arm64, index.js -o plugclient
    - name: Commit build
      run: |
        git config --global user.name github-actions[bot]
        git config --global user.email 41898282+github-actions[bot]@users.noreply.github.com
        git add ./PlugsClientTasmota/plugclient-linux-arm64
        git add ./PlugsClientTasmota/plugclient-linux-x64
        git add ./PlugsClientTasmota/plugclient-win-x64.exe
        git commit -am "Automated binary build"
        git push